package main

import (
	"html/template"
	"os"
	"time"

	sql "github.com/FloatTech/sqlite"
	"github.com/fumiama/emozi"
)

const head = `// Code generated by codegen/radical. å·²ç»ç»è¿‡ä¿®æ”¹, ä¸è¦æ‰‹åŠ¨é‡æ–°è¿è¡Œ.

package emozi

// éƒ¨é¦–åå¤‡ å†…åµŒçš„éƒ¨é¦–åˆ°é¢œæ–‡å­—çš„æ˜ å°„, æ˜¯ç¬¬äºŒä¼˜å…ˆæŸ¥è¯¢é¡ºä½. ç¬¬ä¸€é¡ºä½æ˜¯æ•°æ®åº“çš„éƒ¨é¦–è¡¨. ç¬¬ä¸‰ä½æ˜¯å›è½åˆ° ğŸˆ³ï¸.
var éƒ¨é¦–åå¤‡ = map[rune]string{ {{range .}}
	'{{.R}}': ç©º,{{end}}
}
`

func main() {
	db := sql.Sqlite{DBPath: emozi.EmoziDatabasePath}
	err := db.Open(time.Minute)
	if err != nil {
		panic(err)
	}
	defer db.Close()
	type r struct {
		R rune
	}
	type sr struct {
		R string
	}
	var s r
	var ss = []sr{}
	db.QueryFor("SELECT DISTINCT R FROM emozi;", &s, func() error {
		ss = append(ss, sr{R: string(s.R)})
		return nil
	})
	t, err := template.New("list").Parse(head)
	if err != nil {
		panic(err)
	}
	f, err := os.Create("radical.go")
	if err != nil {
		panic(err)
	}
	defer f.Close()
	err = t.Execute(f, ss)
	if err != nil {
		panic(err)
	}
}
